<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-cabaple" content="yes">
    <title>Liikuntapaikat kartalla</title>
    <script type='text/javascript' src='http://www.openlayers.org/api/OpenLayers.js'></script>
    <style>
	    #header {
	background-color:#006600;
	color:black;
	text-align:center;
	width:70%;
	      	}
	    #nav {
	line-height:30px;
	background-color:#00CC00;
	width:10%;
	float:left;
		}
	    #footer {
	background-color:#006600;
	color:black;
	clear:both;
	text-align:left;
	width:70%;
	    	}
    </style>
    
    <!-- Tassa scriptissa luodaan kaikki kartassa esiintyvat funktiot ja tyokalut -->
    <script>
      var map
      OpenLayers.ProxyHost = "/cgi-bin/proxy.cgi?url=";
      function init() {
      	// Luo kartan, jossa on navigointi mahdollisuus
      	map = new OpenLayers.Map("map", 
		{units:'m',
		controls: [new OpenLayers.Control.Navigation()]
	});
	
	// Lisaa openstreetmapin layeriksi
	OSMmap = new OpenLayers.Layer.OSM();
	
	// Luodaan WMS taso, kutsumalla se geoserverilta. Samalla asetetaan sille halutut parametrit
	var liikuntapaikat = new OpenLayers.Layer.WMS("Liikuntapaikat WMS", "http://130.233.249.20:8080/geoserver/WMS/wms",
		{layers: "WMS:liikuntapaikat",
		transparent: true,
		format: 'image/png'},
		{'opacity': 0.66, 'isBaseLayer': false, projection: 'EPSG:900913'});
	
	var vaesto = new OpenLayers.Layer.WMS("Vaesto", "http://130.233.249.20:8080/geoserver/WMS/wms",
		{layers: "WMS:vaki2014_1km",
		transparent: true,
		format: 'image/png'},
		{'opacity': 0.66, 'isBaseLayer': false, projection: 'EPSG:900913'});
		
	var vaesto_kp = new OpenLayers.Layer.WMS("Vaesto_kp", "http://130.233.249.20:8080/geoserver/WMS/wms",
		{layers: "WMS:vaki2014_1km_kp",
		transparent: true,
		format: 'image/png'},
		{'opacity': 0.66, 'isBaseLayer': false, projection: 'EPSG:900913'});
 
	// Lisaa WFS tason
	var liikuntapaikat_wfs = new OpenLayers.Layer.Vector("Liikuntapaikat WFS", {
		strategies: [new OpenLayers.Strategy.BBOX()],
		protocol: new OpenLayers.Protocol.WFS({
			version: "1.1.0",
			url: "http://130.233.249.20:8080/geoserver/wfs",
			featurePrefix : "WMS",
			featureType: "WFS_pisteet",
			featureNS: "http://130.233.249.20",
			geometryName: "the_geom",
			srsName: "EPSG:4326"})
		});
	// Lisataan aikasemmin luodut tasot kartalle
	map.addLayers([OSMmap, liikuntapaikat, vaesto, vaesto_kp, liikuntapaikat_wfs]);
	// Asetetaan perusnakyman parametrit eli sijainti ja zoomaus taso
	var lat = 60.170833;
	var lon = 24.9375;
	var zoom = 14;
	
	// Lisaa merkintakuviot yhdeksi tasoksi
	var markers = new OpenLayers.Layer.Markers("Markers");
	map.addLayer(markers);
	
	// Etsii kayttajan sijainnin ja tallentaa sen Location nimiseen elementtiin, jota voidaan kutsua universaalisti
	navigator.geolocation.getCurrentPosition(function(position) {
		document.getElementById('Location').innerHTML= 
		" Latitude: " + position.coords.latitude + 
		" Longitude: " + position.coords.longitude;
		
		// Tallentaa koordinaatit lonlat muuttujaan
		var lonLat = new OpenLayers.LonLat(position.coords.longitude, position.coords.latitude)
		.transform(new OpenLayers.Projection("EPSG:4326"), // Muuttaa koordinaatiston WGS 1984:sta EPSG 4326:n
		
		map.getProjectionObject()); // to Spherical Mercator Projection
		markers.addMarker(new OpenLayers.Marker(lonLat)); // Lisaa markkerin haetulle sijainnille
		map.setCenter(lonLat, zoom); // Asettaa kartan kyseiselle sijainnille
	});
	// Lisataan kartalle muutamat tarkeat controllit
	map.addControl(new OpenLayers.Control.LayerSwitcher());
	map.addControl(new OpenLayers.Control.ScaleLine());
	map.addControl(new OpenLayers.Control.Mouseposition());
	map.addControl(new OpenLayers.Control.PanZoomBar());
	
      }
    </script>
  </head>
	
  <body onload="init()">
  	
    <!-- Header osio, johon tulee otsikko ja ehka joki valikko -->
    <div id="header">
    	<h1>Liikuntapaikat kartalla</h1>
    </div>
    
    <!-- Sivupalkki -->
    <!--
    <div id="nav">
    	<button type="button" onclick="alert('Doesn't work yet');">Find route</button>
    	<button type="button" onclick="alert('Doesn't work yet');">Analyze</button>
    </div>
    -->
    
    <!-- Lisaa kartan halutulla koolla -->
    <div id="map" style="height:500px; width:70%"></div>
    
    <!-- Sijoittaa sijannin funktiosta sivulle haluttuun paikkaan -->
    <p id="Location"></p>
    
    <!-- Tahan voidaan laittaa sivun alaosan tietoja, kuten tekijat ja copyright merkinnat -->
    <div id="footer">
    	<h>GIS Software Development course</h>
    </div>

  </body>
</html>
